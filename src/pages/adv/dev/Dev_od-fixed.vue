<template>
    <div class='horizontalSlidingContainer'>
        <div class="testContent">
            <h1>Title</h1>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Vero necessitatibus ducimus cum. Excepturi facilis quas ipsa corrupti labore suscipit fugit voluptatem! Ipsam placeat illo, inventore molestiae incidunt hic molestias ab.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Vero necessitatibus ducimus cum. Excepturi facilis quas ipsa corrupti labore suscipit fugit voluptatem! Ipsam placeat illo, inventore molestiae incidunt hic molestias ab.</p>
        </div>
        <div class="slidingContainerWrapper">
            <div class="slidingContainer">
                <div class="squareBlock">1</div>
                <div class="squareBlock">2</div>
                <div class="squareBlock">3</div>
            </div>
        </div>
        <div class="testContent">
            <h1>Title2</h1>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Vero necessitatibus ducimus cum. Excepturi facilis quas ipsa corrupti labore suscipit fugit voluptatem! Ipsam placeat illo, inventore molestiae incidunt hic molestias ab.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Vero necessitatibus ducimus cum. Excepturi facilis quas ipsa corrupti labore suscipit fugit voluptatem! Ipsam placeat illo, inventore molestiae incidunt hic molestias ab.</p>
        </div>
    </div>
</template>

<script>
export default {
    data() {
        return {
            commonParent: 0,
            slideContainerOffsetTop: 0,
            slideContainerOffsetLeft: 0,
            scroll: 0,
            deltaY: 0,
            deltaYEnterPoint: 0,
            deltaYExitPoint: 0,
            bodyHeight: 0,
        }
    },
    methods: {
        handleScroll (event) {
            

            // slide container block
            const slideContainer = document.querySelector('.slidingContainer');
            if(!this.slideContainerOffsetLeft) {
                this.slideContainerOffsetLeft = slideContainer.offsetLeft;
            }
            const slideContainerOffsetHeight = slideContainer.offsetHeight;
            const squareBlock = document.querySelector('.squareBlock');
            
            // TODO calculate width diractly
            const slideContainerOffsetWidth = squareBlock.offsetWidth*3;
            // slideContainer.style.width = squareBlock.offsetWidth*3 + 'px';
            const slideContainerWrapper = document.querySelector('.slidingContainerWrapper');
            slideContainerWrapper.style.height = slideContainer.offsetHeight + 2 + 'px';
            const externalContainer = document.querySelector('.horizontalSlidingContainer');
            

            this.scroll = window.scrollY || this.scroll;
            
            this.deltaY += +event.deltaY; 
            if(this.deltaY < 0) this.deltaY = 0;
            
            scroll = this.scroll;
            
            
            if(!this.slideContainerOffsetTop) {
                this.slideContainerOffsetTop = slideContainer.offsetTop;
            }
            
            // set sliding container top padding
            const slideContainerTopPadding = 10;

            const slideContainerCurrentTop = slideContainer.getBoundingClientRect().top;

            // console.log('====================================');

            // console.log('slideContainer.offsetTop');
            // console.log(slideContainer.offsetTop);

            // console.log('slideContainerCurrentTop');
            // console.log(slideContainerCurrentTop);

            // console.log('this.slideContainerOffsetTop - slideContainerTopPadding - this.deltaY');
            // console.log(this.slideContainerOffsetTop - slideContainerTopPadding - this.deltaY);
            // console.log(this.slideContainerOffsetTop);
            // console.log(this.deltaY);


            // console.log('slideContainerOffsetHeight');
            // console.log(slideContainerOffsetHeight);
            
            // console.log('scroll');
            // console.log(scroll);

            // console.log('this.scroll');
            // console.log(this.scroll);

            // console.log('this.deltaY');
            // console.log(this.deltaY);

            // console.log('this.deltaYEnterPoint');
            // console.log(this.deltaYEnterPoint);

            // console.log('this.deltaYExitPoint');
            // console.log(this.deltaYExitPoint);

            // console.log('deltaY/scroll');
            // console.log(this.deltaY/this.scroll);
            // console.log(this.scroll/this.deltaY);


            // console.log('slideContainerCurrentTop + slideContainerOffsetHeight + slideContainerTopPadding > 0');
            // console.log(slideContainerCurrentTop + slideContainerOffsetHeight + slideContainerTopPadding > 0);
            
            // console.log('externalContainer.style.position');
            // console.log(externalContainer.style.position);

            // console.log('====================================');
            console.log('slideContainerCurrentTop');
            console.log(slideContainerCurrentTop);
            

            if (slideContainerCurrentTop - slideContainerTopPadding  > 0) {
                console.log('slideConteinerWrapper before');
                
                slideContainer.style.position = 'relative';   
                slideContainer.style.top = this.slideContainerOffsetTop - this.deltaY + 'px';
                slideContainer.style.left = this.slideContainerOffsetLeft + 'px';

                if(this.deltaY > 0) {
                    this.commonParent.style.position = 'relative';
                    this.commonParent.style.top =  -this.deltaY + 'px';
                    this.commonParent.style.left = 10  + 'px';
                }

            } else if (slideContainerCurrentTop - slideContainerTopPadding  <= 0  ) {
                console.log('slideConteinerWrapper inside');


                if(!this.deltaYEnterPoint) {
                    this.deltaYEnterPoint = this.deltaY;
                    this.deltaYExitPoint = this.deltaY + slideContainerOffsetWidth;
                }
                                
                if (this.deltaY > this.deltaYEnterPoint && this.deltaY < this.deltaYExitPoint) {
                    
                    console.log('slideConteinerWrapper inside fixed');
                    this.commonParent.style.position = 'fixed';   
                    this.commonParent.style.top =  - this.deltaYEnterPoint  + 'px';
                    this.commonParent.style.left = 10  + 'px';

       
                slideContainer.style.position = 'fixed';   
                slideContainer.style.left  = this.slideContainerOffsetLeft + this.deltaYEnterPoint - this.deltaY + 'px'; 
                }

                
            } 
            // else {
            //     slideContainer.style.top = this.slideContainerOffsetTop + 'px';
            //     slideContainer.style.left = this.slideContainerOffsetLeft + 'px';
            //     console.log('Hello World!');
            //     this.commonParent.style.position = 'relative';
            //     this.commonParent.style.top =  -this.deltaY + 'px';
            //     this.commonParent.style.left = 10  + 'px';
            // }


        },
        initializeMethod (event) {
            // findout common parent for all components
            const externalContainer = document.querySelector('.slidingContainerWrapper');            
            const bodyChildrenHTMLCollection = document.body.children;
            const bodyChildren = [...bodyChildrenHTMLCollection];
            console.log(bodyChildren);
            const commonParent = bodyChildren.find(child => {
                const idName = child.id;
                const className = child.className;
                
                if (idName) {
                    if (externalContainer.closest(`#${idName}`)) {
                        return child
                    }
                    return false;
                } else if (className) {
                    if (externalContainer.closest(`${className}`)) {
                        return child
                    }
                    return false;
                } else {
                    return false;
                }
            })
            if (commonParent) {
                console.log(commonParent);
                console.log( typeof commonParent);
                
                this.commonParent = commonParent
            } else {
                console.log('To find parent element it should has ID or specific class name. Check it, please'); 
            }
            
        },
    },
    mounted () {
        window.addEventListener('wheel', this.handleScroll);
        window.addEventListener('load', this.initializeMethod)
    },
    destroyed () {
        window.removeEventListener('wheel', this.handleScroll);
        window.addEventListener('load', this.initializeMethod)
    }
}
</script>

<style scoped>

.horizontalSlidingContainer {
    overflow:hidden;
}
.slidingContainer {
    border-width: 2px;
    border-color: blue;
    border-style: solid;
    display: flex;
}
.slidingContainer .squareBlock {
    justify-content: start;
    align-content: space-around;
    height: 300px;
    width: 300px;
    background-color: tomato;
    margin: 1px;
}

.bottom {
    border-width: 2px;
    border-color: blueviolet;  
    border-style: solid;
    display: flex;
}
.bottom .squareBlock {
    justify-content: start;
    align-content: space-around;
    height: 300px;
    width: 300px;
    background-color: blanchedalmond;
    margin: 1px;
}

.testContent {
    text-align: left;
    padding: 10px;
}

</style>
