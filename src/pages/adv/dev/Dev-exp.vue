<template>
    <div class='externalContainer'>
       <div class='internalContainer'>
        <div class="testContent">
            <h1>Title</h1>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Vero necessitatibus ducimus cum. Excepturi facilis quas ipsa corrupti labore suscipit fugit voluptatem! Ipsam placeat illo, inventore molestiae incidunt hic molestias ab.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Vero necessitatibus ducimus cum. Excepturi facilis quas ipsa corrupti labore suscipit fugit voluptatem! Ipsam placeat illo, inventore molestiae incidunt hic molestias ab.</p>
        </div>
        <div class="slidingContainerWrapper">
            <div class="slidingContainer">
                <div class="squareBlock">1</div>
                <div class="squareBlock">2</div>
                <div class="squareBlock">3</div>
            </div>
        </div>
        <div class="testContent">
            <h1>Title2</h1>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Vero necessitatibus ducimus cum. Excepturi facilis quas ipsa corrupti labore suscipit fugit voluptatem! Ipsam placeat illo, inventore molestiae incidunt hic molestias ab.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, ducimus. Iure, alias quibusdam placeat voluptatibus nostrum fugiat delectus labore nam impedit atque commodi aperiam hic ipsum blanditiis. Tenetur, maxime ex.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Vero necessitatibus ducimus cum. Excepturi facilis quas ipsa corrupti labore suscipit fugit voluptatem! Ipsam placeat illo, inventore molestiae incidunt hic molestias ab.</p>
        </div>
       </div>
    </div>
</template>

<script>
import { log } from 'util';
export default {
    data() {
        return {
            commonParent: 0,
            slideContainerOffsetTop: 0,
            slideContainerOffsetLeft: 0,
            scroll: 0,
            scrollEnterPoint: 0,
            scrollExitPoint: 0,
            scrollEnterPointHorizontalSlide: 0,
            scrollExitPointHorizontalSlide: 0,
            bodyHeight: 0,
            fixchildren: false,
            unfixchildren: false,
        }
    },
    methods: {
        handleScroll (event) {
            
            console.log('event');
            console.log(event);
            
            // slide container block
            const slideContainer = document.querySelector('.slidingContainer');
            if(!this.slideContainerOffsetLeft) {
                this.slideContainerOffsetLeft = slideContainer.offsetLeft;
            }
            const slideContainerOffsetHeight = slideContainer.offsetHeight;
            const squareBlock = document.querySelector('.squareBlock');
            
            // TODO calculate width diractly
            const slideContainerOffsetWidth = squareBlock.offsetWidth*3;
            // slideContainer.style.width = squareBlock.offsetWidth*3 + 'px';
            const slideContainerWrapper = document.querySelector('.slidingContainerWrapper');
            slideContainerWrapper.style.height = slideContainer.offsetHeight + 2 + 'px';

            const internalContainer = document.querySelector('.internalContainer');
            
            

            this.scroll = window.scrollY || this.scroll;
            
            scroll = this.scroll;
            
            
            if(!this.slideContainerOffsetTop) {
                this.slideContainerOffsetTop = slideContainer.offsetTop;
            }
            
            // set sliding container top padding
            const slideContainerTopPadding = 10;

            const slideContainerCurrentTop = slideContainer.getBoundingClientRect().top;

            // console.log('====================================');

            // console.log('slideContainer.offsetTop');
            // console.log(slideContainer.offsetTop);

            // console.log('slideContainerCurrentTop');
            // console.log(slideContainerCurrentTop);

            // console.log('this.slideContainerOffsetTop - slideContainerTopPadding - this.deltaY');
            // console.log(this.slideContainerOffsetTop - slideContainerTopPadding - this.deltaY);
            // console.log(this.slideContainerOffsetTop);
            // console.log(this.deltaY);


            // console.log('slideContainerOffsetHeight');
            // console.log(slideContainerOffsetHeight);
            
            console.log('scroll');
            console.log(scroll);

            // console.log('this.scroll');
            // console.log(this.scroll);

            // console.log('this.deltaY');
            // console.log(this.deltaY);

            // console.log('this.deltaYEnterPoint');
            // console.log(this.deltaYEnterPoint);

            // console.log('this.deltaYExitPoint');
            // console.log(this.deltaYExitPoint);

            // console.log('deltaY/scroll');
            // console.log(this.deltaY/this.scroll);
            // console.log(this.scroll/this.deltaY);


            // console.log('slideContainerCurrentTop + slideContainerOffsetHeight + slideContainerTopPadding > 0');
            // console.log(slideContainerCurrentTop + slideContainerOffsetHeight + slideContainerTopPadding > 0);
            
            // console.log('externalContainer.style.position');
            // console.log(externalContainer.style.position);

            // console.log('====================================');
            console.log('slideContainerCurrentTop');
            console.log(slideContainerCurrentTop);
            

            if (slideContainerCurrentTop - slideContainerTopPadding  > 0) {
                
                this.commonParent.style.position = 'relative';
                this.commonParent.style.top =  - scroll + 'px';
                this.commonParent.style.left = 10  + 'px';

                // slideContainer.style.position = 'relative';   
                // slideContainer.style.top = 0  + 'px';
                // slideContainer.style.left = 0 + 'px';

                const externalContainerHTMLCollection = this.externalContainer.children;
                const externalContainerChildren = [...externalContainerHTMLCollection];
                
                // set top value for every fixed element
                let elementHeight = 0;
                externalContainerChildren.forEach(child => {                    
                    child.style.position = 'fixed';
                    child.style.top = this.scroll >= 0 ? - this.scroll : 0 + 'px';
                })


            } else {
                console.log('slideConteinerWrapper inside');

                const slideContainerHTMLCollection  = slideContainer.children;
                const slideContainerChildren = [...slideContainerHTMLCollection];

                // get width of slide container blocks (slideWidth)
                let slideWidth = 0;
                slideContainerChildren.length = slideContainerChildren.length - 1;
                slideContainerChildren.forEach(child => {
                    slideWidth += child.offsetWidth;
                })

                // set eter and exit point when works sliding contition 
                if(!this.scrollEnterPoint) {
                    this.scrollEnterPoint = this.scroll;
                    this.scrollExitPoint = this.scrollEnterPoint + slideWidth;
                }

                if(this.scrollEnterPoint - this.scroll  <= 0 && this.scrollExitPoint - this.scroll > 0) {
                    console.log('DEEP INSIDE');
                    
                    const externalContainerHTMLCollection = this.externalContainer.children;
                    const externalContainerChildren = [...externalContainerHTMLCollection];
                    
                    // set top value for every fixed element
                    let elementHeight = 0;
                    if (!this.fixchildren) {
                        this.fixchildren = true;
                        this.unfixchildren = false;
                        externalContainerChildren.forEach(child => {
                            const childOffsetTop = child.offsetTop;
                            const childOffsetHeight = child.offsetHeight;

                            
                            child.style.top = - this.slideContainerOffsetTop + slideContainerTopPadding + childOffsetTop + elementHeight + 'px';
                            elementHeight += childOffsetHeight;
                            child.style.position = 'fixed';
                        })
                    }

                    if(!this.scrollEnterPointHorizontalSlide) {
                        this.scrollEnterPointHorizontalSlide = this.scroll;
                    }
                    slideContainer.style.left = this.slideContainerOffsetLeft + this.scrollEnterPointHorizontalSlide - this.scroll + 'px';
                }  
            } 
        },
        initializeMethod (event) {
            // findout common parent for all components
            const externalContainer = document.querySelector('.externalContainer');            
            const bodyChildrenHTMLCollection = document.body.children;
            const bodyChildren = [...bodyChildrenHTMLCollection];
            console.log(bodyChildren);
            const commonParent = bodyChildren.find(child => {
                const idName = child.id;
                const className = child.className;
                
                if (idName) {
                    if (externalContainer.closest(`#${idName}`)) {
                        return child
                    }
                    return false;
                } else if (className) {
                    if (externalContainer.closest(`.${className}`)) {
                        return child
                    }
                    return false;
                } else {
                    return false;
                }
            })
            if (commonParent) {
                console.log(commonParent);
                console.log( typeof commonParent);
                commonParent.style.position = 'relative';
                this.commonParent = commonParent;
            } else {
                console.log('To find parent element it should has ID or specific class name. Check it, please'); 
            }

            externalContainer.style.height = this.commonParent.offsetHeight + 'px';            
            this.externalContainer = externalContainer;
        },
    },
    mounted () {
        window.addEventListener('load', this.initializeMethod)
        window.addEventListener('scroll', this.handleScroll);
    },
    destroyed () {
        window.removeEventListener('scroll', this.handleScroll);
        window.addEventListener('load', this.initializeMethod)
    }
}
</script>

<style scoped>

.externalContainer {
    overflow:hidden;
}
.slidingContainer {
    border-width: 2px;
    border-color: blue;
    border-style: solid;
    display: flex;
}
.slidingContainer .squareBlock {
    justify-content: start;
    align-content: space-around;
    height: 300px;
    width: 300px;
    background-color: tomato;
    margin: 1px;
}

.bottom {
    border-width: 2px;
    border-color: blueviolet;  
    border-style: solid;
    display: flex;
}
.bottom .squareBlock {
    justify-content: start;
    align-content: space-around;
    height: 300px;
    width: 300px;
    background-color: blanchedalmond;
    margin: 1px;
}

.testContent {
    text-align: left;
    padding: 10px;
}

</style>
